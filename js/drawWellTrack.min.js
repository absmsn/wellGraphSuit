function initSpatialTrack(){function e(){var e=trackPoints.map(function(e){return new THREE.Vector3(e.x,e.y,g(e.depth))});geometry=(new THREE.BufferGeometry).setFromPoints(e);var o=new THREE.Line(geometry,R);L.add(o);e=trackPoints.map(function(e){return new THREE.Vector3(e.x,e.y,0)});geometry=(new THREE.BufferGeometry).setFromPoints(e);var i=new THREE.Line(geometry,w);L.add(i);for(var r=0;r<trackPoints.length;r++){e=[];var a=trackPoints[r];e.push(new THREE.Vector3(a.x,a.y,g(a.depth))),e.push(new THREE.Vector3(a.x,a.y,0)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var E=new THREE.Line(geometry,B);E.computeLineDistances(),L.add(E)}useFont(function(e){for(var o=t*s,i=t/20,r=new THREE.MeshBasicMaterial({color:f,side:THREE.DoubleSide}),a=0;a<=(v.max-v.min)/t;a++){var E=fAdd(v.min,fMul(t,a)).toString(),c=new THREE.TextGeometry(E,{font:e,size:o,height:i}),l=new THREE.Mesh(c,r);l.position.x=v.min+t*a-o/2,l.position.y=v.min-o,l.position.z=-i/2,l.rotation.z=-Math.PI/2,L.add(l)}for(a=0;a<=(M.max-M.min)/t;a++){E=fAdd(M.min,fMul(t,a)).toString(),c=new THREE.TextGeometry(E,{font:e,size:o,height:i}),l=new THREE.Mesh(c,r);var m=(new THREE.Box3).setFromObject(l);l.position.x=M.min-o-(m.max.x-m.min.x),l.position.y=M.min+t*a-o/2,l.position.z=-i/2,L.add(l)}for(a=0;a<=(P.max-P.min)/n;a++){E=fSub(H,fMul(n,a)).toString(),c=new THREE.TextGeometry(E,{font:e,size:o,height:i}),l=new THREE.Mesh(c,r);l.position.x=o/2,l.position.y=-i/2,l.position.z=P.min+n*a-o/2,l.rotation.x=Math.PI/2,L.add(l)}c=new THREE.TextGeometry("X(E)",{font:e,size:o,height:i}),l=new THREE.Mesh(c,r);l.position.x=v.max+t+j+o/2,l.position.y=-o/2,l.position.z=-i/2,L.add(l);c=new THREE.TextGeometry("Y(N)",{font:e,size:o,height:i}),l=new THREE.Mesh(c,r);l.position.x=-o/2,l.position.y=M.max+t+j+o/2,l.position.z=-i/2,L.add(l);E="Z(depth)",c=new THREE.TextGeometry(E,{font:e,size:o,height:i}),l=new THREE.Mesh(c,r);l.position.x=-o*E.length/3,l.position.y=-i/2,l.position.z=P.max+j+o/2,l.rotation.x=Math.PI/2,L.add(l)});for(r=0;r<=(v.max-v.min)/t;r++){e=[];var c=v.min+t*r;if(0!==c){e.push(new THREE.Vector3(c,M.min,P.min)),e.push(new THREE.Vector3(c,M.max,P.min)),geometry=(new THREE.BufferGeometry).setFromPoints(e);E=new THREE.Line(geometry,material);L.add(E)}}for(r=0;r<=(M.max-M.min)/t;r++){e=[];var l=M.min+t*r;if(0!==l){e.push(new THREE.Vector3(v.min,l,P.min)),e.push(new THREE.Vector3(v.max,l,P.min)),geometry=(new THREE.BufferGeometry).setFromPoints(e);E=new THREE.Line(geometry,material);L.add(E)}}e=[];e.push(new THREE.Vector3(v.min,0,P.min)),e.push(new THREE.Vector3(v.max+t,0,P.min)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var m=new THREE.Line(geometry,d);L.add(m);e=[];e.push(new THREE.Vector3(v.max+t,S/2,P.min)),e.push(new THREE.Vector3(v.max+t,-S/2,P.min)),e.push(new THREE.Vector3(v.max+t+j,0,P.min)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var u=new THREE.Mesh(geometry,d);L.add(u);e=[];e.push(new THREE.Vector3(0,M.min,P.min)),e.push(new THREE.Vector3(0,M.max+t,P.min)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var h=new THREE.Line(geometry,T);L.add(h);e=[];e.push(new THREE.Vector3(-S/2,M.max+t,P.min)),e.push(new THREE.Vector3(S/2,M.max+t,P.min)),e.push(new THREE.Vector3(0,M.max+t+j,P.min)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var p=new THREE.Mesh(geometry,T);L.add(p);e=[];e.push(new THREE.Vector3(0,0,P.min)),e.push(new THREE.Vector3(0,0,P.max)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var x=new THREE.Line(geometry,y);L.add(x);e=[];e.push(new THREE.Vector3(-S/2,0,P.max)),e.push(new THREE.Vector3(S/2,0,P.max)),e.push(new THREE.Vector3(0,0,P.max+j)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var b=new THREE.Mesh(geometry,y);L.add(b)}var t,n,o=!0,i=10,r=10,a=2,s=.3,E="#ff0000",c="#00ff00",l="#0000ff",m="#35a066",f=baseColor,u=baseColor,h=baseColor;if(configObj&&configObj.spatialTrack){var p=configObj.spatialTrack;i=p.xyGridNum||i,r=p.zGridNum||r,E=p.xAxisColor||E,c=p.yAxisColor||c,l=p.zAxisColor||l,f=p.fontColor||f,a=p.maxZToXyRatio||a,m=p.verticalLineColor||m,u=p.trackLineColor||u,h=p.projectionLineColor||h,s=p.fontSizeToUnitRatio||s,"boolean"==typeof p.autoRotate&&(o=p.autoRotate)}var d=new THREE.LineBasicMaterial({color:E,side:THREE.DoubleSide}),T=new THREE.LineBasicMaterial({color:c,side:THREE.DoubleSide}),y=new THREE.LineBasicMaterial({color:l,side:THREE.DoubleSide}),R=new THREE.LineBasicMaterial({color:u,side:THREE.DoubleSide}),w=new THREE.LineBasicMaterial({color:h,side:THREE.DoubleSide}),H=Math.max.apply(null,depths),x=xyFarthest;H/xyFarthest>a&&(x=H/a),t=getApproximateGridSize(x,i,factorArray),x=fMul(i,t),n=getApproximateGridSize(H,r,factorArray),H=fMul(r,n);var g=function(e){return fSub(H,e)},v=(depths.map(function(e){return g(e)}),{min:-x,max:x}),M={min:-x,max:x},P={min:g(H),max:g(0)},b=10,z=1/3,G=H-Math.max.apply(null,depths),B=new THREE.LineDashedMaterial({color:m,dashSize:G/b*(1-z),gapSize:G/b*z}),S=t/2,j=t,k=document.getElementById("spatialTrack");k.style.display="";var V=new THREE.WebGLRenderer({antialias:!0,canvas:k,preserveDrawingBuffer:!0});V.setSize(k.offsetWidth,k.offsetHeight),V.setClearColor(new THREE.Color("white"));var L=new THREE.Scene,F=new THREE.PerspectiveCamera(45,k.offsetWidth/k.offsetHeight,1,1e5);F.up.x=0,F.up.y=0,F.up.z=1,F.position.set(-x,-x,P.max),F.lookAt(0,0,P.min),k.style.display="none";var C=new THREE.OrbitControls(F,k);C.enableDamping=!0,C.autoRotate=o,spatialTrack=new CanvasGraph(e,{renderer:V,scene:L,camera:F,controls:C}),k.addEventListener("click",function(){C.autoRotate=!1}),k.addEventListener("touchstart",function(){C.autoRotate=!1})}function initHorizontalProjection(){function e(){var e=trackPoints.map(function(e){return new THREE.Vector3(e.x,e.y,0)});geometry=(new THREE.BufferGeometry).setFromPoints(e);var n=new THREE.Line(geometry,f);z.add(n);e=[];e.push(new THREE.Vector3(M.min,0,0)),e.push(new THREE.Vector3(M.max,0,0)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var i=new THREE.Line(geometry,l);z.add(i);e=[];e.push(new THREE.Vector3(0,P.min,0)),e.push(new THREE.Vector3(0,P.max,0)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var r=new THREE.Line(geometry,m);z.add(r);for(var s=0;s<=(M.max-M.min)/t;s++){e=[];var E=M.min+t*s;if(0!==E){e.push(new THREE.Vector3(E,P.min,0)),e.push(new THREE.Vector3(E,P.max,0)),geometry=(new THREE.BufferGeometry).setFromPoints(e);var c=new THREE.Line(geometry,material);z.add(c)}}for(s=0;s<=(P.max-P.min)/t;s++){e=[];var u=P.min+t*s;if(0!==u){e.push(new THREE.Vector3(M.min,u,0)),e.push(new THREE.Vector3(M.max,u,0)),geometry=(new THREE.BufferGeometry).setFromPoints(e);c=new THREE.Line(geometry,material);z.add(c)}}var h="x",p=64,d=t/20,T=t*o,y=new THREE.MeshBasicMaterial({color:a,side:THREE.DoubleSide}),R=new THREE.PointsMaterial({color:baseColor,size:t/5}),w=new THREE.LineBasicMaterial({color:baseColor});targetPoints.forEach(function(e){var t=new THREE.BufferGeometry;t.setAttribute("position",new THREE.Float32BufferAttribute([e.x,e.y,0],3));var n=new THREE.Points(t,R);z.add(n);for(var o=[],i=0;i<=p;i++){var r=i/p*(2*Math.PI);o.push(new THREE.Vector3(Math.cos(r)*e.r+e.x,Math.sin(r)*e.r+e.y,0))}t=(new THREE.BufferGeometry).setFromPoints(o);var a=new THREE.Line(t,w);z.add(a);for(i=0;i<trackPoints.length-1;i++)if(!(e.depth<trackPoints[i].depth||e.depth>trackPoints[i+1].depth)){var s=(e.depth-trackPoints[i+1].depth)/(trackPoints[i].depth-trackPoints[i+1].depth),E=trackPoints[i+1].x+(trackPoints[i].x-trackPoints[i+1].x)*s,c=trackPoints[i+1].y+(trackPoints[i].y-trackPoints[i+1].y)*s;Math.sqrt(Math.pow(E-e.x,2)+Math.pow(c-e.y,2))<=e.r&&useFont(function(e){var t=new THREE.TextGeometry(h,{font:e,size:T,height:d}),n=new THREE.Mesh(t,y),o=(new THREE.Box3).setFromObject(n);n.position.x=E-(o.max.x-o.min.x)/2,n.position.y=c-(o.max.y-o.min.y)/2,n.position.z=-d/2,z.add(n)})}}),useFont(function(e){for(var n=t*o,i=t/20,r=new THREE.MeshBasicMaterial({color:a,side:THREE.DoubleSide}),s=0;s<=(M.max-M.min)/t;s++){var E=fAdd(M.min,fMul(t,s)).toString();if("0"!==E){var c=new THREE.TextGeometry(E,{font:e,size:n,height:i}),l=new THREE.Mesh(c,r),m=(new THREE.Box3).setFromObject(l);l.position.x=M.min+t*s-n/2,l.position.y=(m.max.x-m.min.x)/2,l.position.z=-i/2,l.rotation.z=-Math.PI/2,z.add(l)}}for(s=0;s<=(P.max-P.min)/t;s++){E=fAdd(P.min,fMul(t,s)).toString(),c=new THREE.TextGeometry(E,{font:e,size:n,height:i}),l=new THREE.Mesh(c,r),m=(new THREE.Box3).setFromObject(l);l.position.x=-(m.max.x-m.min.x)/2,l.position.y=P.min+t*s-n/2,l.position.z=-i/2,z.add(l)}c=new THREE.TextGeometry("X(E)",{font:e,size:n,height:i}),l=new THREE.Mesh(c,r);l.position.x=M.max+n,l.position.y=-n/2,l.position.z=-i/2,z.add(l);c=new THREE.TextGeometry("Y(N)",{font:e,size:n,height:i}),l=new THREE.Mesh(c,r),m=(new THREE.Box3).setFromObject(l);l.position.x=-(m.max.x-m.max.y)/2,l.position.y=P.max+n,l.position.z=-i/2,z.add(l)})}var t,n=10,o=.3,i="#ff0000",r="#00ff00",a=baseColor,s=baseColor,E=document.getElementById("horizontalProjection");if(E.style.display="",configObj&&configObj.horizontalProjection){var c=configObj.horizontalProjection;n=c.xyGridNum||n,i=c.xAxisColor||i,r=c.yAxisColor||r,a=c.fontColor||a,s=c.trackLineColor||s,o=c.fontSizeToUnitRatio||o}var l=new THREE.LineBasicMaterial({color:i,side:THREE.DoubleSide}),m=new THREE.LineBasicMaterial({color:r,side:THREE.DoubleSide}),f=new THREE.LineBasicMaterial({color:s,side:THREE.DoubleSide}),u=getApproximateGridSize(xyFarthest,n,factorArray);fMul(n,u);t=u;var h=Math.min.apply(null,xs.concat(targetPoints.map(function(e){return e.x-e.r}))),p=Math.min.apply(null,ys.concat(targetPoints.map(function(e){return e.y-e.r}))),d=Math.max.apply(null,ys.concat(targetPoints.map(function(e){return e.y+e.r}))),T=Math.max.apply(null,xs.concat(targetPoints.map(function(e){return e.x+e.r})));h=h>=0?0:-fMul(Math.ceil(fDivision(-h,t)),t),p=p>=0?0:-fMul(Math.ceil(fDivision(-p,t)),t),d=d>=0?fMul(Math.ceil(fDivision(d,t)),t):t,T=T>=0?fMul(Math.ceil(fDivision(T,t)),t):t;var y=fSub(T,h),R=fSub(d,p),w=fSub(R,y),H=fMul(Math.ceil(fDivision(Math.abs(w),t)),t);w>0?Math.abs(h)>Math.abs(T)?T=fAdd(T,H):h=fSub(h,H):Math.abs(d)>Math.abs(p)?d=fAdd(d,H):p=fSub(p,H),y=fSub(T,h),R=fSub(d,p);var x=fDivision(fAdd(h,T),2),g=fDivision(fAdd(d,p),2),v=getCameraHeightFullContain(y,R,E.offsetWidth,E.offsetHeight,vViewAngle);v*=1.2;var M={min:h,max:T},P={min:p,max:d},b=new THREE.WebGLRenderer({antialias:!0,canvas:E,preserveDrawingBuffer:!0});b.setSize(E.offsetWidth,E.offsetHeight),b.setClearColor(new THREE.Color("white"));var z=new THREE.Scene,G=new THREE.PerspectiveCamera(vViewAngle,E.offsetWidth/E.offsetHeight,1,1e5);G.up.x=0,G.up.y=1,G.up.z=0,G.position.set(x,g,v),G.lookAt(x,g,0),E.style.display="none";var B=new THREE.OrbitControls(G,E);B.enableRotate=!1,B.target=new THREE.Vector3(x,g,0),horizontalProjection=new CanvasGraph(e,{renderer:b,scene:z,camera:G,controls:B})}function initVerticalProjection(){function e(){for(var e=0;e<=(w.max-w.min)/T;e++){var t=[],o=w.min+T*e;if(0!==o){t.push(new THREE.Vector3(o,H.min,0)),t.push(new THREE.Vector3(o,H.max,0)),geometry=(new THREE.BufferGeometry).setFromPoints(t);var i=new THREE.Line(geometry,material);P.add(i)}}for(e=0;e<=(H.max-H.min)/T;e++){t=[];var a=H.min+T*e;if(0!==a){t.push(new THREE.Vector3(w.min,a,0)),t.push(new THREE.Vector3(w.max,a,0)),geometry=(new THREE.BufferGeometry).setFromPoints(t);i=new THREE.Line(geometry,material);P.add(i)}}t=[];t.push(new THREE.Vector3(w.min,0,0)),t.push(new THREE.Vector3(w.max,0,0)),geometry=(new THREE.BufferGeometry).setFromPoints(t);var d=new THREE.Line(geometry,u);P.add(d);t=[];t.push(new THREE.Vector3(0,H.min,0)),t.push(new THREE.Vector3(0,H.max,0)),geometry=(new THREE.BufferGeometry).setFromPoints(t);var x=new THREE.Line(geometry,h);P.add(x);t=trackPoints.map(function(e,t){return new THREE.Vector3(l[t],y(e.depth),0)});geometry=(new THREE.BufferGeometry).setFromPoints(t);var g=new THREE.Line(geometry,p);if(P.add(g),kop){t=[];t.push(new THREE.Vector3(-T/5,y(kop),0)),t.push(new THREE.Vector3(T/5,y(kop),0));var v=new THREE.LineBasicMaterial({color:s});geometry=(new THREE.BufferGeometry).setFromPoints(t);var M=new THREE.Line(geometry,v);P.add(M)}if(targetPoints.length>0){var b=new THREE.LineBasicMaterial({color:E});targetPoints.forEach(function(e,t){var n=[];n.push(new THREE.Vector3(m[t]-e.r,y(e.depth),0)),n.push(new THREE.Vector3(m[t]+e.r,y(e.depth),0)),geometry=(new THREE.BufferGeometry).setFromPoints(n);var o=new THREE.Line(geometry,b);P.add(o)})}var z=new THREE.MeshBasicMaterial({color:r}),G=T*n,B=T/20;useFont(function(e){for(var t=0;t<=(w.max-w.min)/T;t++){var n=fAdd(w.min,fMul(T,t)).toString(),o=new THREE.TextGeometry(n,{font:e,size:G,height:B}),i=new THREE.Mesh(o,z);i.rotation.z=-Math.PI/2;var r=(new THREE.Box3).setFromObject(i);i.position.x=w.min+T*t-G/2,i.position.y=r.max.y-r.min.y+G/2,i.position.z=-B/4,P.add(i)}for(t=0;t<=(H.max-H.min)/T;t++){n=R(fAdd(H.min,fMul(T,t))).toString();if("0"!==n){o=new THREE.TextGeometry(n,{font:e,size:G,height:B}),i=new THREE.Mesh(o,z),r=(new THREE.Box3).setFromObject(i);i.position.x=-(r.max.x-r.min.x)/2,i.position.y=H.min+T*t+G/4,i.position.z=-B/2,P.add(i)}}});var S=new THREE.MeshBasicMaterial({color:c,side:THREE.DoubleSide}),j=T/2,k=T/3,V=w.max+T/3,L=H.max-T/2+k/2,F=new THREE.Shape;F.moveTo(V,L),F.lineTo(V+j/4,L-k/2),F.lineTo(V,L-k),F.lineTo(V+j,L-k/2),F.lineTo(V,L),geometry=new THREE.ShapeGeometry(F);var C=new THREE.Mesh(geometry,S);P.add(C),useFont(function(e){var t=f,n=new THREE.TextGeometry(t,{font:e,size:G,height:B}),o=new THREE.Mesh(n,z),i=(new THREE.Box3).setFromObject(o);o.position.x=V+j/2-(i.max.x-i.min.x)/2,o.position.y=L-k-1.5*G,o.position.z=-B/2,P.add(o)})}var t=10,n=.3,o="#ff0000",i="#00ff00",r=baseColor,a="#cf52a3",s="#aa6973",E="#0572b8",c="#ab4977",l=hTrackPoints,m=hTargetPoints,f=directionText;config&&(t=config.gridNum||t,o=config.hAxisColor||o,i=config.depthAxisColor||i,r=config.fontColor||r,n=config.fontSizeToUnitRatio||n,a=config.trackLineColor||a,c=config.directionLabelColor||c);var u=new THREE.LineBasicMaterial({color:o}),h=new THREE.LineBasicMaterial({color:i}),p=new THREE.LineBasicMaterial({color:a}),d=Math.max(Math.max.apply(null,depths),Math.abs(Math.max.apply(null,l)),Math.abs(Math.min.apply(null,l))),T=getApproximateGridSize(d,t,factorArray),y=function(e){return-e},R=function(e){return-e},w={min:-fMul(Math.round(t/2),T),max:fMul(Math.round(t/2),T)},H={min:y(fMul(t,T)),max:0},x=document.getElementById(canvasId);x.style.display="";var g=new THREE.WebGLRenderer({antialias:!0,canvas:x,preserveDrawingBuffer:!0}),v=(H.min+H.max)/2,M=getCameraHeightFullContain(w.max-w.min,H.max-H.min,x.offsetWidth,x.offsetHeight,vViewAngle);M*=1.2;var P=new THREE.Scene,b=new THREE.PerspectiveCamera(vViewAngle,x.offsetWidth/x.offsetHeight,1,1e5);b.position.set(0,v,M),b.lookAt(0,v,0),g.setSize(x.offsetWidth,x.offsetHeight),g.setClearColor(new THREE.Color("white")),x.style.display="none";var z=new THREE.OrbitControls(b,x);z.enableRotate=!1,z.target=new THREE.Vector3(0,v,0),x.style.display="none";var G=new CanvasGraph(e,{renderer:g,scene:P,camera:b,controls:z});"verticalProjectionEW"===canvasId?verticalProjectionEW=G:"verticalProjectionNS"===canvasId&&(verticalProjectionNS=G)}function initVerticalProjectionEW(){canvasId="verticalProjectionEW",config=configObj&&configObj.verticalProjectionEW,hTargetPoints=targetPoints.map(function(e){return e.x}),hTrackPoints=xs,directionText="E",initVerticalProjection()}function initVerticalProjectionNS(){canvasId="verticalProjectionNS",config=configObj&&configObj.verticalProjectionNS,hTargetPoints=targetPoints.map(function(e){return e.y}),hTrackPoints=ys,directionText="N",initVerticalProjection()}function getApproximateGridSize(e,t,n){if(0!==n.length){n.sort(function(e,t){return t-e});for(var o=fDivision(e,t),i=0;i<n.length;i++){if(n[i]<=o){o=n[i];break}if(i===n.length-1)return}var r=Math.ceil(fDivision(e,fMul(o,t)));return o=fMul(o,r),o}}function postDrawFinished(){var e=document.getElementById("loadingText");e&&(e.style.display="none")}function getCameraHeightFullContain(e,t,n,o,i){var r;if(n/o>e/t)r=t/2/Math.tan(THREE.MathUtils.degToRad(i/2));else{var a=t*(o/n/(t/e));r=a/2/Math.tan(THREE.MathUtils.degToRad(i/2))}return r}function triggerInitError(e){var t=document.getElementById("loadingText");throw t&&(t.innerText=e,t.style.color="red"),Error(e)}function init(){loadConfigFile()}function initGraph(){initSpatialTrack(),initHorizontalProjection(),initVerticalProjectionEW(),initVerticalProjectionNS(),curGraph=spatialTrack,curGraph.show(),postDrawFinished()}function fetchTargetPoints(){var e=configObj.targetPointsDataURL,t=new XMLHttpRequest;t.open("GET",e),t.onreadystatechange=function(){if(4===t.readyState){if(200===t.status)try{var e=0;configObj&&configObj.defaultTargetRadius&&(e=configObj.defaultTargetRadius),targetPoints=JSON5.parse(t.responseText),targetPoints=targetPoints.map(function(t){return{y:t.xzb-t.jkzzbx,x:t.yzb-t.jkhzby,depth:t.csb,r:null===t.ybbqbj?e:t.ybbqbj}})}catch(e){triggerInitError("靶点数据不是一个有效的对象!")}else triggerInitError("靶点数据加载失败!");initGraph()}},t.send()}function fetchTrackPoints(){trackPoints[0]&&trackPoints[0].zxd&&(kop=parseFloat(trackPoints[0].zxd)),trackPoints=trackPoints.map(function(e){return{x:parseFloat(e.dxpy),y:parseFloat(e.nbpy),depth:parseFloat(e.cs)}}),xs=trackPoints.map(function(e){return e.x}),ys=trackPoints.map(function(e){return e.y}),depths=trackPoints.map(function(e){return e.depth}),xyFarthest=Math.max(Math.abs(Math.max.apply(null,xs)),Math.abs(Math.min.apply(null,xs)),Math.abs(Math.max.apply(null,ys)),Math.abs(Math.min.apply(null,ys))),initGraph()}function loadConfigFile(){var e=new XMLHttpRequest;e.open("GET",configPath),e.onreadystatechange=function(){if(4===e.readyState){if(200===e.status)try{configObj=JSON5.parse(e.responseText)}catch(e){triggerInitError("配置对象不是一个有效的对象!")}else triggerInitError("配置文件加载失败,请检查配置文件的位置!");fetchTrackPoints()}},e.send()}function CanvasGraph(e,t){function n(){requestAnimationFrame(n),s&&s.update(),E.render(c,l)}function o(){var e=m.offsetWidth,t=m.offsetHeight;l.aspect=e/t,l.updateProjectionMatrix(),E.setSize(e,t),E.render(c,l)}function i(){"none"!==m.style.display&&o()}if(!e)throw Error("缺乏必要的初始化函数!");var r=!1,a=e,s=t.controls,E=t.renderer,c=t.scene,l=t.camera,m=null;if(this.canvas=m,!E)throw Error("没有渲染器参数!");if(!l)throw Error("没有相机参数!");m=E.domElement,this.show=function(){m&&m.style&&(m.style.display="",r?o():(a.call(this),s?n():o(),window.addEventListener("resize",i),r=!0))},this.hide=function(){m&&m.style&&(m.style.display="none")},this.reset=function(){s&&s.reset()},this.export=function(){if(m){var e=document.createElement("a");e.download="canvas.png",e.href=m.toDataURL(),e.click(),e.remove()}},s&&(this.startRotate=function(){s.autoRotate=!0},this.stopRotate=function(){s.autoRotate=!1})}function fMul(e,t){var n=0,o=0,i=e+"",r=t+"";n=i.split(".")[1]?i.split(".")[1].length:0,o=r.split(".")[1]?r.split(".")[1].length:0;var a=Math.pow(10,n+o);return Number(i.replace(".",""))*Number(r.replace(".",""))/a}function fAdd(e,t){var n=0,o=0,i=e+"",r=t+"";n=i.split(".")[1]?i.split(".")[1].length:0,o=r.split(".")[1]?r.split(".")[1].length:0;var a=Math.pow(10,Math.max(n,o));return(fMul(e,a)+fMul(t,a))/a}function fSub(e,t){var n=0,o=0,i=e+"",r=t+"";n=i.split(".")[1]?i.split(".")[1].length:0,o=r.split(".")[1]?r.split(".")[1].length:0;var a=Math.pow(10,Math.max(n,o));return(fMul(e,a)-fMul(t,a))/a}function fDivision(e,t){var n=0,o=0,i=e+"",r=t+"";n=i.split(".")[1]?i.split(".")[1].length:0,o=r.split(".")[1]?r.split(".")[1].length:0;var a=Math.pow(10,Math.max(o,n)),s=fMul(e,a),E=fMul(t,a);return s/E}var kop;window.addEventListener("load",function(){init();for(var e=document.getElementsByName("typeSel"),t=0;t<e.length;t++){var n=e[t];n.addEventListener("change",function(){var e;curGraph&&curGraph.hide(),"spatial"===this.value?e=spatialTrack:"verticalEW"===this.value?e=verticalProjectionEW:"verticalNS"===this.value?e=verticalProjectionNS:"horizontal"===this.value&&(e=horizontalProjection),e&&(curGraph=e,curGraph.show())})}var o=document.getElementById("reset-btn");o&&o.addEventListener("click",function(){curGraph&&curGraph.reset()});var i=document.getElementById("export-btn");i&&i.addEventListener("click",function(){curGraph&&curGraph.export()})});var geometry,configObj,xyFarthest,xs,ys,depths,curGraph,spatialTrack,verticalProjectionEW,horizontalProjection,verticalProjectionNS,canvasId,config,hTargetPoints,hTrackPoints,directionText,vViewAngle=45,fontPath="./font/optimer_regular.typeface.json",configPath="./config.json",baseColor="#000000",factorArray=[1e4,1e3,100,10,1,.1,.01,.001,1e-4,1e-5,1e-6],trackPoints=[{dxpy:25.64,nbpy:32.05,cs:105,zxd:200},{dxpy:-47,nbpy:37,cs:115},{dxpy:22,nbpy:66,cs:266},{dxpy:77,nbpy:72,cs:605}],targetPoints=[{yzb:44,jkhzby:0,xzb:70,jkzzbx:0,csb:400,ybbqbj:50}],material=new THREE.LineBasicMaterial({color:baseColor}),useFont=function(){var e=null,t=null,n=[],o=new THREE.FontLoader;return o.load(fontPath,function(e){t=e}),function(o){t?o(t):(n.push(o),e||(e=setInterval(function(){t&&(n.forEach(function(e){e(t)}),n.splice(0,n.length),clearInterval(e))},10)))}}();